{appState !== 'review' && (
    <div className="relative z-10 w-full max-w-xl bg-white/80 backdrop-blur-lg p-6 md:p-12 rounded-[2.5rem] shadow-2xl border border-white/40">
        <header className="text-center mb-8">
        <h1 className="text-3xl md:text-4xl font-extrabold text-pink-800">超強逐字記錄器</h1>
        <p className="text-gray-600 mt-2 text-sm md:text-base">即時錄音 • 自動分群 • 智能轉錄</p>
        </header>
        <div className="flex flex-col items-center space-y-8">
        {(isRecordingOrPaused || isTranscribing) && (
            <div className="w-full text-center">
            <div className="mb-4">
                <p className={`text-6xl font-extrabold transition-colors duration-500 ${isRecordingOrPaused ? 'text-red-500' : 'text-gray-400'}`}>
                {formatTime(recordingTime)}
                </p>
                <p className="text-sm text-gray-500 uppercase font-semibold tracking-wider mt-1">
                {isRecordingOrPaused ? (appState === 'recording' ? '錄音中...' : '已暫停') : '音訊處理中...'}
                {/* 顯示防休眠狀態 */}
                {appState === 'recording' && <span className="block text-[10px] text-green-500 mt-1 flex items-center justify-center"><Zap className="w-3 h-3 mr-1"/>防休眠啟用中</span>}
                </p>
            </div>
            <div className={`transition-opacity duration-300 ${appState === 'recording' ? 'opacity-100' : 'opacity-20'} h-24`}>
                <AudioVisualizer analyser={analyserRef.current} isRecording={appState === 'recording'} />
            </div>
            </div>
        )}
        {renderController()}
        </div>
        
        {/* Signature at bottom of main screen */}
        <div className="mt-auto pt-6 pb-4 text-center">
            <p className="text-xs font-black tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-fuchsia-600 to-pink-600 hover:from-fuchsia-500 hover:to-pink-500 transition-all">
                DESIGNED BY 王智德
            </p>
            <a href="mailto:weisun0254@gmail.com" className="text-[10px] font-bold text-indigo-500 hover:text-indigo-700 tracking-wide mt-1 block transition-colors">
                weisun0254@gmail.com
            </a>
        </div>
    </div>
  )}

  {renderReviewOverlay()}
  {renderConfirmationModal()}
  {showApiKeyModal && (
    <ApiKeyModal 
        currentKey={userApiKey} 
        onClose={() => setShowApiKeyModal(false)} 
        onSave={handleSaveApiKey} 
    />
  )}
  
  {showRenamerModal && transcriptionResult && audioBlob && (
    <SpeakerRenamer 
        transcript={transcriptionResult.transcript} 
        audioUrl={stableAudioUrl}
        onClose={() => setShowRenamerModal(false)}
        onApply={handleRenameApply}
    />
  )}
  
  {showAnalysisModal && (
    <AIAnalysisModal 
      title={analysisTitle}
      content={analysisContent}
      isLoading={isAnalyzing}
      onClose={() => setShowAnalysisModal(false)}
    />
  )}

  {showComparisonModal && transcriptionResult && (
    <ComparisonModal
        title={comparisonTitle}
        icon={comparisonIcon}
        originalText={transcriptionResult.transcript}
        processedText={processedText}
        isLoading={isProcessing}
        onClose={() => setShowComparisonModal(false)}
        audioUrl={stableAudioUrl}
        isTranslation={isTranslationMode}
    />
  )}
  
  {showChatModal && transcriptionResult && (
     <AIChatModal
        onClose={() => setShowChatModal(false)}
        onAskAI={callGeminiChat}
        isLoading={isChatLoading}
        answer={chatAnswer}
     />
  )}

  <style>{`
    @keyframes pulse-slow { 0%, 100% { opacity: 0.5; transform: scale(1); } 50% { opacity: 0.7; transform: scale(1.05); } }
    .animate-pulse-slow { animation: pulse-slow 2s infinite ease-in-out; }
    @keyframes blob { 0% { transform: translate(0px, 0px) scale(1); } 33% { transform: translate(30px, -50px) scale(1.1); } 66% { transform: translate(-20px, 20px) scale(0.9); } 100% { transform: translate(0px, 0px) scale(1); } }
    .animate-blob { animation: blob 7s infinite; }
    .animation-delay-2000 { animation-delay: 2s; }
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #fbcfe8; border-radius: 20px; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .animate-fade-in { animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
  `}</style>
</div>
